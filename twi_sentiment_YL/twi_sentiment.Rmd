---
output: html_document
---


```{r,echo=F,include=FALSE,warning=FALSE}
library(readxl)
library(data.table)
library(tidyverse)
library(igraph)
library(dplyr)
library(ggthemes)
library(ggplot2)
library(igraph)
library(tibble)
library(plotly)
library(network)
library(DT)
library(wordcloud)
library(sna)
library(ndtv)
library(visNetwork)
library(ggrepel)
library(networkD3)
library(gridExtra)

twi <-  read_excel("E:/DV/pro/twi\\DV_sentiment_NEW.xlsx")
twi<-as.data.table(twi)

twi<-twi%>%
mutate(Sentiment=ifelse(sentiment>= 0.05,"positive",ifelse(sentiment <= -0.05,"negative","neutral")))

twi<-twi%>%
mutate(twi_date=as.Date(twi$date,format="%Y-%m-%d"))%>%
mutate(td= format(as.Date(twi_date, "%m/%d/%Y"),"%Y-%m"))
```

# Sentiment Analysis
## Sentiment State Distribution of Tweets
```{r,echo=F,warning=FALSE,include=FALSE}
three<-twi%>%
  select(Sentiment)%>%
  group_by(Sentiment)%>%
  count(Sentiment)
```


```{r,echo=F,warning=FALSE}
ggplot(three, aes(x=Sentiment, y=n, fill=Sentiment)) +
  geom_bar(stat="identity")+theme_minimal()+labs(x = "Sentiment Categories", y = "Number of Tweets",
       title = "Sentiment State Distribution of Tweets")+theme(legend.position="none")+ 
scale_fill_manual("legend", values = c("positive" = "#FF6666", "neutral" = "#faead3", "negative" = "#106d9c"))
```
```{r,echo=F,warning=FALSE,include=FALSE}
num<-twi%>%
  select(twi_date,Sentiment)%>%
  group_by(twi_date,Sentiment)%>%
  count(twi_date,Sentiment)
```


```{r,echo=F,warning=FALSE}
ggplot(num, aes(x = twi_date, y = n,colour= Sentiment)) +scale_x_date(breaks = "25 day")+ theme_minimal()+geom_line(size=1.2)+labs(x = "Date of Tweets", y = "Number of Tweets",
       title = "Timeline showing Sentiment of Tweets about COVID-19 Vaccines") + scale_color_manual(values=c("#106d9c", "yellow",  "#FF6666"))
```


```{r,echo=F,warning=FALSE,include=FALSE}
pos <-  read_csv("E:/DV/pro/twi/pos.csv")
neu <-  read_csv("E:/DV/pro/twi/neu.csv")
neg <-  read_csv("E:/DV/pro/twi/neg.csv")
```


```{r,echo=F,warning=FALSE}
set.seed(12)
layout(matrix(c(1, 2), nrow=2), heights=c(1, 4))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Positive")
wordcloud(words = pos$tokenize, freq = pos$n, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```

```{r,echo=F,warning=FALSE}
set.seed(12)
layout(matrix(c(1, 2), nrow=2), heights=c(1, 4))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Negative")
wordcloud(words = neg$tokenize, freq = neg$n, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```

```{r,echo=F,warning=FALSE}
set.seed(12)
layout(matrix(c(1, 2), nrow=2), heights=c(1, 4))
par(mar=rep(0, 4))
plot.new()
text(x=0.5, y=0.5, "Neutral")
wordcloud(words = neu$tokenize, freq = neu$n, min.freq = 1,
          max.words=200, random.order=FALSE, rot.per=0.35, 
          colors=brewer.pal(8, "Dark2"))
```




## Portrait of Popular Tweets and Users
```{r,echo=F,warning=FALSE,include=FALSE}
favor<-twi%>%
  select(favorites,Sentiment)%>%
  arrange(-favorites)%>%  
  slice(1:15)
```


```{r,echo=F,warning=FALSE}
ggplot(data=favor,aes(y=as.factor(favorites), x=favorites,fill=Sentiment) ) + 
  geom_bar(stat="identity")+labs(x = "Number of Times it was Favorited", y = "Tweets",
       title = "Sentiment State of Top 15 Popular Tweets base on favorited times ")+theme_minimal()+  theme(
        axis.text.y=element_blank(),axis.ticks.y=element_blank())+ geom_text(aes(label=paste0(favorites)), vjust=0.5,hjust=1)+ 
scale_fill_manual("legend", values = c("positive" = "#FF6666", "neutral" = "#faead3", "negative" = "#106d9c"))
```

```{r,echo=F,warning=FALSE,include=FALSE}
retwe<-twi%>%
  select(retweets,Sentiment)%>%
  arrange(-retweets)%>%  
  slice(1:15)
```


```{r,echo=F,warning=FALSE}
ggplot(data=retwe,aes(y=as.factor(retweets), x=retweets,fill=Sentiment) ) + 
  geom_bar(stat="identity")+labs(x = "Number of Times it was Retweeted", y = "Tweets",
       title = "Sentiment State of Top 15 Popular Tweets base on retweeted times ")+theme_minimal()+ theme(
        axis.text.y=element_blank(),axis.ticks.y=element_blank())+ geom_text(aes(label=paste0(retweets)), vjust=0.5,hjust=1)+ 
scale_fill_manual("legend", values = c("positive" = "#FF6666", "neutral" = "#faead3", "negative" = "#106d9c"))
```



```{r,echo=F,warning=FALSE,include=FALSE}
follow <-  read_csv("E:/DV/pro/twi/follow.csv")%>%
  mutate(Sentiment=sent_ca)
```


```{r,echo=F,warning=FALSE}
ggplot(follow, aes(x=factor(user_name), fill=Sentiment))+
  geom_bar(width=0.7)+
  theme_minimal()+ 
  theme(axis.text.x = element_text(angle = 70, hjust = 0.5, 
                              vjust = 0.5,color = "black",size=9))+labs(x = "User Name", y = "Number of Tweets",
       title = "Sentiment State of Tweets of Top 10 Users who have most followers ")+ 
scale_fill_manual("legend", values = c("positive" = "#FF6666", "neutral" = "#faead3", "negative" = "#106d9c"))
```









