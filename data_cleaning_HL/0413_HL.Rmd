---
title: "5063 group project"
author: "Haogeng Liu"
date: "2021/4/13"
output: html_document
---

```{r}
library(readr)
library(tidyverse)

```

```{r}

# # This is the VAERS data - by 2021.03.31
# VAERSData <- read.csv('data/VAERS_datasets_20210331/2021VAERSData.csv')
# VAERSSYMPTOMS <- read.csv('data/VAERS_datasets_20210331/2021VAERSSYMPTOMS.csv')
# VAERSVAX <- read.csv('data/VAERS_datasets_20210331/2021VAERSVAX.csv')
# 
# # daily_admin <- read.csv('data/us-daily-covid-vaccine-doses-administered.csv')
# 
# # covid19_vaccinations_in_the_united_states <- read.csv('data/covid19_vaccinations_in_the_united_states.csv')
# 
# #vaccine allocation data by state
# allocation_Pfizer <- read.csv('data/COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Pfizer.csv')
# allocation_Moderna <- read.csv('data/COVID-19_Vaccine_Distribution_Allocations_by_Jurisdiction_-_Moderna.csv')

```

`state_party`
```{r}
# # The results of the state elections come from the data provided in the Week 5 lecture.
# state_party <- read.csv('data/state_party.csv')

```


```{r}

# # This data set is originated from the VAERS data set above, from 2020-12-14 to 2021-03-31.
# # The results of the state elections come from the data provided in the Week 5 lecture.
# # The data cleaning process is completed by Excel.
# 
# vac<-read.csv('data/clean/vac.csv')
# 
# vac = rename(vac, c('facility'='V_ADMINBY'))
# 
# facility<- vac %>%
#   filter(facility %in% c('PUB','PVT','MIL','OTH')) %>%
#   filter(STATE %in% state_party$state2) %>%
#   group_by(STATE,facility) %>%
#   summarize(cases = n_distinct(VAERS_ID))
# 
# case_facility <- left_join(state_party, facility, by = c('state2' = 'STATE'))
# 
# 
# write.csv(case_facility, file = 'case_facility_clean.csv')

```



## Report rate 1: allocation by state

`allocation`
 This data set is originated from the allocation data set above, including the vaccine allocation of Pfizer and Moderna in 50 states and the District of Columbia before 2021-03-31.
 The results of the state elections come from the data provided in the Week 5 lecture.
 The data cleaning process is completed by Excel.

```{r}

# This data set is originated from the allocation data set above, including the vaccine allocation of Pfizer and Moderna in 50 states and the District of Columbia before 2021-03-31.
# The results of the state elections come from the data provided in the Week 5 lecture.
# The data cleaning process is completed by Excel.

allocation <- read.csv('data/clean/allocation_clean.csv')

```


```{r}

#
p1<-ggplot(allocation, aes(x = state1, y=allocation, 
                             col = manufacturer , 
                             fill = manufacturer )) + 
geom_bar(stat = 'identity')+
  labs(x = "State", y = "Allocation", 
       title = "Vaccine allocation of Pfizer and Moderna - by state")+
  theme_light()+
  # scale_color_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  # scale_fill_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  coord_flip()
  # facet_grid(target.party ~ .)+
  # geom_text(aes(label=paste('manufacturer:', manufacturer), x=state1, y=50), hjust = 0, color="white") +
  # theme(plot.title = element_text(size = 15, hjust = 0.5), 
  #       axis.text.x = element_text(), 
  #       axis.text.y = element_text(), 
  #       axis.title.x = element_text(size = 10), 
  #       axis.title.y = element_text(size = 10),
  #       legend.position = 'none',
  #       strip.background = element_rect(colour = "black", fill = "black"),
  #       strip.text.x = element_text(colour = "white",size = 10),
  #       panel.spacing = unit(1, "lines"))

p1

```

The number of vaccine allocations in each state does not have a brand tendency.
In every state, the number of vaccine allocations for the two brands is basically the same.

**Possible forms of visualization: ** bar, map

## Report rate 1: report rate by state & 2020 election result

`case_vac`
 This data set is originated from the VAERS data set and the daily vaccinations data set above, including the number of people vaccinated (before 2021-03-31) and the number of side effect case reported (from 2020-12-14 to 2021-03-31) in 50 states and the District of Columbia. 
 The results of the state elections come from the data provided in the Week 5 lecture.
 The data cleaning process is completed by Excel.

```{r}

# This data set is originated from the VAERS data set and the daily vaccinations data set above, including the number of people vaccinated (before 2021-03-31) and the number of side effect case reported (from 2020-12-14 to 2021-03-31) in 50 states and the District of Columbia. 
# The results of the state elections come from the data provided in the Week 5 lecture.
# The data cleaning process is completed by Excel.

case_vac <- read.csv('data/clean/case_vac_clean.csv')

# rate represents the proportion of side effects cases per 100,000 people who have been vaccinated
case_vac <- case_vac %>% 
  mutate(rate = 100000*case/vaccinations)

```


```{r}
p2<-ggplot(case_vac, aes(x = state1, y=rate, 
                             col = party , 
                             fill = party )) + 
geom_bar(stat = 'identity')+
  labs(x = "State", y = "Side effect rate (per 100k vaccinated)", 
       title = "Side effect rate - by state")+
  theme_light()+
  scale_color_manual(values = c('Blue','Red'),
                     breaks = c('DEMOCRAT','REPUBLICAN'))+
  scale_fill_manual(values = c('Blue','Red'),
                     breaks = c('DEMOCRAT','REPUBLICAN'))+
  coord_flip()
  # facet_grid(target.party ~ .)+
  # geom_text(aes(label=paste('manufacturer:', manufacturer), x=state1, y=50), hjust = 0, color="white") +
  # theme(plot.title = element_text(size = 15, hjust = 0.5), 
  #       axis.text.x = element_text(), 
  #       axis.text.y = element_text(), 
  #       axis.title.x = element_text(size = 10), 
  #       axis.title.y = element_text(size = 10),
  #       legend.position = 'none',
  #       strip.background = element_rect(colour = "black", fill = "black"),
  #       strip.text.x = element_text(colour = "white",size = 10),
  #       panel.spacing = unit(1, "lines"))

p2
```

The reporting rate of vaccine side effects in each state does not seem to be significantly related to the party's victory in the 2020 election. But New York has the highest reporting rate, more than double that of Montana, the second highest.

**Possible forms of visualization: ** bar, map


## Report rate 2: report rate by manufacturer

`case_manu`
 This data set is originated from the VAERS data set above, including the number of side effect case reported (from 2020-12-14 to 2021-03-31) by manufacturer in 50 states and the District of Columbia. 
 The results of the state elections come from the data provided in the Week 5 lecture.
 The data cleaning process is completed by Excel.

```{r}

# This data set is originated from the VAERS data set above, including the number of side effect case reported (from 2020-12-14 to 2021-03-31) by manufacturer in 50 states and the District of Columbia. 
# The results of the state elections come from the data provided in the Week 5 lecture.
# The data cleaning process is completed by Excel.

case_manu <- read.csv('data/clean/case_manu_clean.csv')


p3<-ggplot(case_manu, aes(x = state1, y=case_manu, 
                             col = manu , 
                             fill = manu )) + 
geom_bar(stat = "identity", position = position_dodge())+
  labs(x = "State", y = "Cases", 
       title = "Side effect cases reported of Pfizer and Moderna - by state")+
  theme_light()+
  # scale_color_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  # scale_fill_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  coord_flip()
  # facet_grid(target.party ~ .)+
  # geom_text(aes(label=paste('manufacturer:', manufacturer), x=state1, y=50), hjust = 0, color="white") +
  # theme(plot.title = element_text(size = 15, hjust = 0.5), 
  #       axis.text.x = element_text(), 
  #       axis.text.y = element_text(), 
  #       axis.title.x = element_text(size = 10), 
  #       axis.title.y = element_text(size = 10),
  #       legend.position = 'none',
  #       strip.background = element_rect(colour = "black", fill = "black"),
  #       strip.text.x = element_text(colour = "white",size = 10),
  #       panel.spacing = unit(1, "lines"))

p3

```

According to previous visulizations, there is no significant difference in the number of vaccine allocations between Moderna and Pfizer in each state. However, Pfizerâ€™s vaccine has more reported cases of side effects.

**Possible forms of visualization: ** bar, map

*We have the vaccine administration data of different brands, but the date is as of April 10, which does not match the data date of the case we used*

## Report rate: Where? report rate by facility

`case_facility`
 This data set is originated from the VAERS data set above, including the number of side effect case reported (from 2020-12-14 to 2021-03-31) by facility in 50 states and the District of Columbia. 
 The results of the state elections come from the data provided in the Week 5 lecture.
 The data cleaning process is completed by Excel.

```{r}
# This data set is originated from the VAERS data set above, including the number of side effect case reported (from 2020-12-14 to 2021-03-31) by facility in 50 states and the District of Columbia. 
# The results of the state elections come from the data provided in the Week 5 lecture.
# The data cleaning process is completed by Excel.

case_facility <- read.csv('data/clean/case_facility_clean.csv')

p4<-ggplot(case_facility, aes(x = state1, y=cases, 
                             col = facility , 
                             fill = facility )) + 
geom_bar(stat = 'identity')+
  labs(x = "State", y = "Cases", 
       title = "Side effect cases reported of facilities - by state")+
  theme_light()+
  # scale_color_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  # scale_fill_manual(values = c('Blue','Red'), 
  #                    breaks = c('Pfizer','Moderna'))+
  coord_flip()
  # facet_grid(target.party ~ .)+
  # geom_text(aes(label=paste('manufacturer:', manufacturer), x=state1, y=50), hjust = 0, color="white") +
  # theme(plot.title = element_text(size = 15, hjust = 0.5), 
  #       axis.text.x = element_text(), 
  #       axis.text.y = element_text(), 
  #       axis.title.x = element_text(size = 10), 
  #       axis.title.y = element_text(size = 10),
  #       legend.position = 'none',
  #       strip.background = element_rect(colour = "black", fill = "black"),
  #       strip.text.x = element_text(colour = "white",size = 10),
  #       panel.spacing = unit(1, "lines"))

p4

```

Most of the reported cases of vaccine side effects were administered the vaccine in private facilities.

**Possible forms of visualization: ** bar, map

*I did not find the vaccine administration data of different facilities, this part may be of little significance or can be canceled*


